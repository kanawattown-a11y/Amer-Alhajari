<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>عارض PDF — قنوات</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --primary:#c31432;
    --dark:#111;
    --muted:#f5f5f5;
    --btn-radius:8px;
  }
  html,body{height:100%;margin:0;font-family:"Cairo",system-ui,Arial,Helvetica,sans-serif;background:var(--muted);color:var(--dark);-webkit-font-smoothing:antialiased}
  header{
    width:100%;
    background:linear-gradient(90deg,var(--primary),#9b1226);
    color:#fff;
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 14px;
    box-sizing:border-box;
    box-shadow:0 2px 6px rgba(0,0,0,0.12);
  }
  header img.logo{height:44px;width:auto;border-radius:6px;background:#fff;padding:4px}
  header h1{font-size:18px;margin:0;font-weight:700}

  .controls{
    width:100%;
    max-width:1100px;
    margin:12px auto 6px;
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:center;
    flex-wrap:wrap;
    padding:0 12px;
    box-sizing:border-box;
  }
  .controls .group{display:flex;gap:8px;align-items:center}
  button.ctrl{
    background:transparent;
    border:2px solid rgba(0,0,0,0.08);
    padding:8px 12px;
    border-radius:var(--btn-radius);
    cursor:pointer;
    font-weight:600;
    min-width:44px;
    box-shadow:0 1px 0 rgba(255,255,255,0.2) inset;
    transition:all .14s ease;
    background-color:#fff;
  }
  button.ctrl.primary{
    background:var(--primary); color:#fff; border-color:transparent;
  }
  button.ctrl:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  .page-label{font-weight:600}

  .viewer-wrap{
    width:100%;
    display:flex;
    justify-content:center;
    padding:8px 12px 40px;
    box-sizing:border-box;
  }
  .viewer{
    width:100%;
    max-width:1100px;
    background:#fff;
    border-radius:10px;
    box-shadow:0 10px 30px rgba(0,0,0,0.06);
    padding:12px;
    box-sizing:border-box;
  }
  canvas#pdf-canvas{width:100%;height:auto;display:block;border-radius:4px}

  .fallback{
    text-align:center;
    margin-top:8px;
    color:#444;
    font-size:14px;
  }
  .fallback a{color:var(--primary);font-weight:700;text-decoration:none}

  @media (max-width:640px){
    header h1{font-size:16px}
    button.ctrl{padding:8px 10px;font-size:14px}
  }
</style>
</head>
<body>

<header>
  <img class="logo" src="favicon-doc.png" alt="KANAWAT logo" />
  <h1>صفحة بلدة قنوات الأولى — عارض المستندات</h1>
</header>

<div class="controls" role="toolbar" aria-label="أدوات عرض PDF">
  <div class="group">
    <button id="prev" class="ctrl">◀</button>
    <button id="next" class="ctrl">▶</button>
  </div>

  <div class="group page-label" aria-live="polite">
    <span id="pageNum">1</span> / <span id="pageCount">1</span>
  </div>
</div>

<div class="viewer-wrap">
  <div class="viewer" id="viewer">
    <canvas id="pdf-canvas" role="img" aria-label="مستند PDF"></canvas>
    <div class="fallback">إذا لم يعمل العرض اضغط <a id="downloadLink" href="#" target="_blank" rel="noopener">هنا لتحميل الملف</a></div>
  </div>
</div>

<script type="module">
import * as pdfjsLib from './pdf.mjs';

pdfjsLib.GlobalWorkerOptions.workerSrc = './pdf.worker.mjs';

const url = 'الصفحة%20الرئيسية.pdf'; // اسم الملف مع ترميز المسافات إن وجدت
const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const pageNumSpan = document.getElementById('pageNum');
const pageCountSpan = document.getElementById('pageCount');
const downloadLink = document.getElementById('downloadLink');

let pdfDoc = null;
let pageNum = 1;

function renderPage(num){
  pdfDoc.getPage(num).then(page => {
    // حساب المقياس التلقائي ليتناسب مع عرض الحاوي
    const containerWidth = Math.min(document.getElementById('viewer').clientWidth, 1100);
    const unscaledViewport = page.getViewport({ scale: 1 });
    const automaticScale = (containerWidth - 24) / unscaledViewport.width; // خصم الحشوة
    const finalScale = Math.max(0.6, Math.min(2.2, automaticScale)); // ثوابت معقولة لمنع التشوه

    const viewport = page.getViewport({ scale: finalScale });
    canvas.width = Math.floor(viewport.width);
    canvas.height = Math.floor(viewport.height);

    const renderCtx = { canvasContext: ctx, viewport };
    page.render(renderCtx).promise.then(() => {
      pageNumSpan.textContent = pageNum;
      downloadLink.href = url;
    });
  }).catch(err => {
    console.error('Render page error:', err);
  });
}

function queueRenderPage(num){
  if (!pdfDoc) return;
  if (num < 1 || num > pdfDoc.numPages) return;
  pageNum = num;
  renderPage(pageNum);
}

// تحميل الوثيقة
pdfjsLib.getDocument(url).promise.then(pdf => {
  pdfDoc = pdf;
  pageCountSpan.textContent = pdf.numPages;
  renderPage(pageNum);
}).catch(err => {
  console.error('Failed to load PDF:', err);
  downloadLink.href = url;
  downloadLink.textContent = 'تحميل الملف';
});

// ربط الأزرار السابقة/التالية
document.getElementById('prev').addEventListener('click', () => queueRenderPage(pageNum - 1));
document.getElementById('next').addEventListener('click', () => queueRenderPage(pageNum + 1));

// إعادة الحساب عند تغيير حجم الشاشة
window.addEventListener('resize', () => {
  if (pdfDoc) renderPage(pageNum);
});
</script>

</body>
</html>
